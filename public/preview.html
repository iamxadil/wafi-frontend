<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- 
      ============================================================
      âš¡ AL-WAFI PRODUCT PREVIEW FALLBACK
      Works for:
      - WhatsApp preview
      - Facebook preview
      - Twitter
      - Telegram
      - Discord
      - LinkedIn
      ============================================================
    -->

    <script>
      // Extract the product ID from URL: /preview/<id>
      const pathParts = window.location.pathname.split("/");
      const id = pathParts[pathParts.length - 1];

      // Backend OG preview endpoint (YOUR SERVER)
      const backendOG = `https://api.alwafi.net/api/products/preview/${id}`;

      // Detect if the visitor is a crawler (bots that require OG HTML)
      const isBot = /facebook|twitter|linkedin|telegram|whatsapp|discord|bot|crawler|spider|embed/i
        .test(navigator.userAgent);

      if (!id) {
        document.write("<h2>Invalid preview link</h2>");
      }

      if (isBot) {
        // ðŸ”µ BOT DETECTED â€” fetch OG HTML from backend
        fetch(backendOG)
          .then(res => res.text())
          .then(html => {
            document.open();
            document.write(html); // Write backend OG HTML
            document.close();
          })
          .catch(err => {
            document.write("<h2>Preview unavailable</h2>");
          });
      } else {
        // ðŸŸ¢ HUMAN USER â†’ redirect to actual product page
        window.location.href = `/product/${id}`;
      }
    </script>
  </head>

  <body>
    <!-- Empty, script will load content -->
  </body>
</html>
